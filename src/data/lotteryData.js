// ========================================================
// å§“åå­¸ + å…«å­—å‘½ç†å¼•æ“ (2026 ä¸™åˆé¦¬å¹´å°ˆç”¨ãƒ»æœ€çµ‚æ•´åˆç‰ˆ)
// ========================================================
import CHAR_STROKES from './strokesData'; 

// å¤©å¹²åœ°æ”¯äº”è¡Œå®šç¾©
const TIANGAN_WUXING = { 'ç”²':'wood','ä¹™':'wood','ä¸™':'fire','ä¸':'fire','æˆŠ':'earth','å·±':'earth','åºš':'metal','è¾›':'metal','å£¬':'water','ç™¸':'water' };
const DIZHI_WUXING = { 'å­':'water','ä¸‘':'earth','å¯…':'wood','å¯':'wood','è¾°':'earth','å·³':'fire','åˆ':'fire','æœª':'earth','ç”³':'metal','é…‰':'metal','æˆŒ':'earth','äº¥':'water' };
const ZODIAC = { 'å­':'é¼ ','ä¸‘':'ç‰›','å¯…':'è™','å¯':'å…”','è¾°':'é¾','å·³':'è›‡','åˆ':'é¦¬','æœª':'ç¾Š','ç”³':'çŒ´','é…‰':'é›','æˆŒ':'ç‹—','äº¥':'è±¬' };

// 2026 ä¸™åˆå¹´ç’°å¢ƒæ¬Šé‡ (ç«æ—ºå¹´)
const WUXING_AFFINITY_2026 = { 'fire': 100, 'wood': 90, 'earth': 80, 'metal': 50, 'water': 40 };

// --------------------------------------------------------
// åŸºç¤é‚è¼¯å‡½æ•¸
// --------------------------------------------------------

function getCharStrokes(char) {
  // å„ªå…ˆæŸ¥è¡¨ï¼Œè‹¥ç„¡å‰‡å›å‚³ unicode è¡ç”Ÿå€¼ä½œç‚ºå‚™æ´
  return CHAR_STROKES[char] || (char.charCodeAt(0) % 15) + 3;
}

function strokeToWuxing(strokes) {
  const s = ((strokes - 1) % 10) + 1;
  if (s <= 2) return 'wood';
  if (s <= 4) return 'fire';
  if (s <= 6) return 'earth';
  if (s <= 8) return 'metal';
  return 'water';
}

function calcNameScore(name) {
  let totalStrokes = 0;
  for (const ch of name) totalStrokes += getCharStrokes(ch);
  const wuxing = strokeToWuxing(totalStrokes);
  return { totalStrokes, wuxing, affinity: WUXING_AFFINITY_2026[wuxing] || 50 };
}

function calcBaziScore(birthday) {
  if (!birthday) return { score: 50, tg: 'ä¸™', dz: 'åˆ', yearWuxing: 'fire' };
  const year = parseInt(birthday.split('-')[0]);
  const tg = ['åºš','è¾›','å£¬','ç™¸','ç”²','ä¹™','ä¸™','ä¸','æˆŠ','å·±'][year % 10];
  const dz = ['ç”³','é…‰','æˆŒ','äº¥','å­','ä¸‘','å¯…','å¯','è¾°','å·³','åˆ','æœª'][year % 12];
  const tgWx = TIANGAN_WUXING[tg];
  const dzWx = DIZHI_WUXING[dz];
  // ç”Ÿè‚–åœ°æ”¯åœ¨ 2026 å½±éŸ¿é¡¯è‘—ï¼Œæ¬Šé‡ä½” 60%
  const score = (WUXING_AFFINITY_2026[tgWx] || 50) * 0.4 + (WUXING_AFFINITY_2026[dzWx] || 50) * 0.6;
  return { score, tg, dz, yearWuxing: tgWx, dzWuxing: dzWx };
}

// --------------------------------------------------------
// 32 å‰‡åˆ†è¼ªæ¬¡å®¢è£½åŒ–é‘‘å®šèª
// --------------------------------------------------------
export function buildDivinationText(person, roundId) {
  const n = calcNameScore(person.name);
  const b = calcBaziScore(person.birthday);
  const WX_ZH = { fire:'ç«', wood:'æœ¨', water:'æ°´', metal:'é‡‘', earth:'åœŸ' };
  const { totalStrokes: s, wuxing: wx } = n;
  const { tg, dz } = b;
  const nameWx = WX_ZH[wx];
  const zodiac = ZODIAC[dz] || 'é¦¬';

  const hashIndex = [...person.name].reduce((acc, c) => acc + c.charCodeAt(0), 0) % 8;

  const templates = {
    // ç¬¬ä¸€è¼ªï¼šäº”è¡Œè£œé‹
    1: [
      `ã€è£œé‹ã€‘å§“åã€Œ${person.name}ã€è¡Œèµ° ${s} ç•«å±¬${nameWx}ã€‚2026 ä¸™åˆå¹´ç«æ—ºï¼Œä½ é€™æ ¼æ­£å¥½ã€Œç«æ°´æ—¢æ¿Ÿã€ï¼Œä¸éœ€åª½ç¥–æ“å¿ƒï¼Œè‡ªå¸¶å°æš–çˆé€¢å‡¶åŒ–å‰ã€‚`,
      `ã€è£œé‹ã€‘${person.name}å±¬${zodiac}ï¼Œç”Ÿå¹³ç©å¾·ã€‚ä»Šå¹´æµå¹´èµ°ã€Œ${nameWx}ã€é‹ï¼Œå¦‚é­šå¾—æ°´ï¼Œé€™ä»½çé …åªæ˜¯é¦¬å¹´å°è²¡ä¸æ–·çš„é–‹ç«¯ã€‚`,
      `ã€è£œé‹ã€‘AI åµæ¸¬åˆ°ä½ çš„å‘½æ ¼åœ¨ 2026 å¸¶æœ‰ã€Œåè²¡æº¢å‡ºã€ã€‚ç­†åŠƒ ${s} ç•«å®Œç¾é¿é–‹ç‡¥ç«ï¼Œä»Šå¹´é€™ä»½ç¦æ°£çï¼Œä¿ä½ æ•´å¹´é †é¢¨é †æ°´ã€‚`,
      `ã€è£œé‹ã€‘ä¸å¿…é¡¯éˆä¹Ÿä¸­çï¼${person.name}å§“åä¸­ã€Œ${nameWx}ã€æ°£åè¶³ï¼Œåœ¨é›¢ç«å¤§é‹ä¸­è‡ªå‹•è£œè¶³é‹æ°£ï¼Œä»Šæ—¥å¾—çï¼Œååˆ©é›™æ”¶ã€‚`,
      `ã€è£œé‹ã€‘å±¬${zodiac}çš„ä½ ä»Šå¹´è²´äººæ˜Ÿé–ƒè€€ã€‚åå­— ${s} ç•«æ ¼æ¸…é›…ï¼Œä¸™åˆå¹´ç«æ—ºä¸ç‡¥ï¼Œä»Šæ—¥å¾—çæ˜¯å¤©æ™‚åœ°åˆ©ä¹‹åˆã€‚`,
      `ã€è£œé‹ã€‘äº”è¡Œä¸­ã€Œ${nameWx}ã€æ­£æ—ºï¼${person.name}ä»Šå¹´ä¸åƒ…è‡ªå¸¶è²¡æ°£ï¼Œé‚„èƒ½æ—ºåˆ°èº«é‚Šäººã€‚æŠ½åˆ°æ­¤çï¼Œè±¡å¾µé¦¬å¹´å°ç¢ºå¹¸é€£é€£ã€‚`,
      `ã€è£œé‹ã€‘é¦¬å¹´å°æš–çˆï¼${person.name}å§“åç­†åŠƒèˆ‡æµå¹´${tg}ç›¸ç”Ÿã€‚é€™ä¸æ˜¯å¶ç„¶ï¼Œæ˜¯ä½ çš„äº”è¡Œèƒ½é‡åœ¨ 2026 é”åˆ°äº†å®Œç¾å¹³è¡¡ã€‚`,
      `ã€è£œé‹ã€‘${tg}${dz}å¹´ç”Ÿäººï¼Œå±¬${zodiac}ã€‚ä»Šæ—¥ä¸­çä¹ƒæ˜¯ã€Œç«æ—ºç”Ÿè²¡ã€ä¹‹å…†ï¼Œåå­— ${s} ç•«æ ¼å±€ç©©é‡ï¼Œå¿…èƒ½å®ˆä½é€™ä»½ç¦æ°£ã€‚`
    ],
    // ç¬¬äºŒè¼ªï¼šå¤©åå¥‘å­
    2: [
      `ã€å¥‘å­ã€‘åª½ç¥–å®åš€ï¼šå±¬${zodiac}çš„ä½ ä»Šå¹´ç«æ°£è¼ƒå¤§ã€‚ç‰¹è³œæ­¤çä½œç‚ºã€Œé™ç«å¹³å®‰ç¬¦ã€ï¼Œä¿ä½‘ ${person.name} åœ¨ 2026 è¬äº‹å¹³é †ï¼Œå¿ƒå¹³æ°£å’Œã€‚`,
      `ã€å¥‘å­ã€‘${person.name}ç”Ÿæ–¼${tg}${dz}å¹´ï¼Œä»Šå¹´é€¢é©›é¦¬æ˜Ÿå‹•ã€‚åª½ç¥–æ“”å¿ƒä½ å¥”æ³¢è¾›è‹¦ï¼Œç‰¹åˆ¥ã€Œç½©ã€ä½ ï¼Œä»Šæ—¥è³œçï¼Œå‡ºå…¥å¹³å®‰ï¼Œå£“é©šåŒ–å‰ã€‚`,
      `ã€å¥‘å­ã€‘AI é‹ç®—è­¦å‘Šï¼š${zodiac}å¹´ç”Ÿäººä»Šå¹´æ˜“å¿ƒæµ®æ°£èºã€‚é€™ä»½çé …æ˜¯åª½ç¥–è³œäºˆçš„ã€Œå®šå¿ƒä¸¸ã€ï¼Œä¿ä½‘ ${person.name} è²¡æºå»£é€²ï¼Œé é›¢ç´›æ“¾ã€‚`,
      `ã€å¥‘å­ã€‘å¤©åé»åï¼${person.name}å§“å ${s} ç•«ç¨é¡¯ç‡¥ç†±ï¼Œåª½ç¥–ç‰¹æ„ç‚ºä½ ã€Œå£“ç«ã€ã€‚æŠ½åˆ°æ­¤çï¼Œä»£è¡¨ä»Šå¹´æœ‰ç¥è­·é«”ï¼Œæ±‚è²¡å¾—è²¡ã€‚`,
      `ã€å¥‘å­ã€‘å±¬${zodiac}çš„ä½ ï¼Œä»Šå¹´æœ‰å¤©é†«æ˜Ÿç…§æ‹‚ã€‚åª½ç¥–é€éé€™å€‹çé …å‘Šè¨´ ${person.name}ï¼šåˆ¥æ“”å¿ƒï¼Œæœ‰åª½ç¥–åœ¨ï¼Œä¸€åˆ‡å¹³å®‰ï¼`,
      `ã€å¥‘å­ã€‘ä¸™åˆå¹´ç«æ°£æ—ºï¼Œ${person.name}å±¬${zodiac}éœ€é˜²æ°´å…‹ã€‚åª½ç¥–è³œä½ æ­¤ä»½æ¦®è­½ï¼ŒåŠ©ä½ æ°´ç«èª¿å’Œï¼Œé¦¬å¹´å¹³å®‰ç¬¦å·²å…¥è¢‹ï¼`,
      `ã€å¥‘å­ã€‘é€™ä»½åå–®æ˜¯å¤©åé¸çš„ï¼${person.name}ä»Šå¹´æµå¹´èµ°ã€Œ${nameWx}ã€ï¼Œåª½ç¥–ç‰¹åˆ¥çœ·é¡§ï¼ŒæŠ½åˆ°æ­¤çä»£è¡¨ä»Šå¹´ã€Œç¥å…‰æ™®ç…§ã€ã€‚`,
      `ã€å¥‘å­ã€‘å£“é©šæ±‚åˆ©ï¼${person.name}å±¬${zodiac}åœ¨é¦¬å¹´é‹å‹¢èµ·ä¼ï¼Œåª½ç¥–ç‰¹è³œæ­¤çé®ä½è²¡åº«ï¼Œä¿ä½  2026 ç‘æ°£ç›ˆé–€ã€‚`
    ],
    // ç¬¬ä¸‰è¼ªï¼šèµ¤é¦¬éŠœé‡‘
    3: [
      `ã€éŠœé‡‘ã€‘44äººå”¯ä¸€å¤©é¸ï¼${person.name}å§“å ${s} ç•«ã€Œç«ä¸­ç…‰é‡‘ã€ã€‚åœ¨ä¸™åˆå¹´é€™æŠŠç†Šç†Šçƒˆç«ä¸­ï¼Œä½ å°±æ˜¯é‚£å¡Šèƒ½æ‰¿è¼‰è²¡å¯Œçš„çœŸé‡‘ï¼`,
      `ã€éŠœé‡‘ã€‘é‹å‹¢æ”¶å‰²æ©Ÿï¼${person.name}å±¬${zodiac}ï¼Œç”Ÿæ–¼${tg}${dz}ã€‚ä½ çš„å‘½æ ¼å…·å‚™ã€Œèµ¤é¦¬éŠœé‡‘ã€ä¹‹è±¡ï¼Œä»Šæ—¥è„«ç©è€Œå‡ºï¼Œæ˜¯å‘½é‹æœ€è¯éº—çš„å®‰æ’ã€‚`,
      `ã€éŠœé‡‘ã€‘ä¸™åˆé¦¬å¹´ç«èƒ½å…‹é‡‘ï¼Œäº¦èƒ½ç…‰é‡‘ã€‚${person.name}åå­—ä¸­å¸¶æœ‰å¼·å¤§çš„ã€Œ${nameWx}ã€æ°£ï¼Œèƒ½å°‡ç«æ°£è½‰åŒ–ç‚ºé‡‘æ°£ï¼Œé€™ä»½è²¡æ°£ï¼Œéä½ è«å±¬ï¼`,
      `ã€éŠœé‡‘ã€‘è‡³å°Šè²¡æ˜Ÿé™è‡¨ï¼${person.name}ç­†åŠƒ ${s} ç•«ï¼Œå‘½ä¸­è‡ªå¸¶ã€Œé‡‘åŒ±ã€ã€‚44äººä¸­å”¯æœ‰ä½ èƒ½é§•é¦­é¦¬å¹´çš„è²¡å¯Œçƒˆç«ï¼Œæ­å–œæˆç‚ºè²¡å¯Œå¤©é¸ä¹‹äººï¼`,
      `ã€éŠœé‡‘ã€‘ç«ç…‰çœŸé‡‘ï¼å±¬${zodiac}çš„ ${person.name} åœ¨ 2026 å¹´é‹å‹¢å¦‚çƒˆæ—¥ç•¶ç©ºã€‚æ­¤çè±¡å¾µè²¡æºæ»¾æ»¾ï¼Œä»Šæ—¥ä½ æ˜¯å…¨å ´æœ€æ—ºçš„ã€Œé‹å‹¢æ”¶å‰²æ©Ÿã€ã€‚`,
      `ã€éŠœé‡‘ã€‘é‡‘åŒ±é–‹å•Ÿï¼${person.name}ç”Ÿæ–¼${tg}${dz}å¹´ï¼Œåå­—æ ¼å…¥è²¡ä½ã€‚ä»Šæ—¥ä¸­çä¹ƒæ˜¯ã€Œèµ¤é¦¬é€è²¡ã€ï¼Œä¿ä½ é¦¬å¹´å¯Œè²´é€¼äººï¼Œä¸å¯é™é‡ã€‚`,
      `ã€éŠœé‡‘ã€‘å¤©å‘½æ­¸ä¸€ï¼${person.name}å§“åä¸­çš„ã€Œ${nameWx}ã€èˆ‡ä¸™åˆå¹´é”æˆå®Œç¾è«§æŒ¯ã€‚é€™ä¸åªæ˜¯éŒ¢å¤šï¼Œé€™æ˜¯ä½ å‘½é‹åœ¨ 2026 çš„å·”å³°æ™‚åˆ»ã€‚`,
      `ã€éŠœé‡‘ã€‘é¦¬å¹´å”¯ä¸€ç‹è€…ï¼${person.name}å±¬${zodiac}ï¼Œå§“å ${s} ç•«ã€‚åœ¨ç«æ—ºä¹‹å¹´ï¼Œä½ å…·å‚™ã€Œä»¥ç«ç”Ÿè²¡ã€çš„ç¥å¥‡åŠ›é‡ï¼Œæ­å–œç¨å¾—è²¡å¯Œå¤§çï¼`
    ],
    // ç¬¬å››è¼ªï¼šæ°´ç«æ—¢æ¿Ÿ
    4: [
      `ã€æ—¢æ¿Ÿã€‘æœ€é«˜å¢ƒç•Œï¼${person.name}ç”Ÿæ–¼${tg}${dz}å¹´ï¼Œå§“åå¸¶ã€Œ${nameWx}ã€ã€‚ä½ å…·å‚™ã€Œæ½¤ç‰©ç´°ç„¡è²ã€çš„ç‰¹è³ªï¼Œå”¯æœ‰ä½ èƒ½é§•é¦­é€™å°è’¸é‹ï¼Œå°‡ç«æ°£åŒ–ç‚ºè’¸æ°£ã€‚`,
      `ã€æ—¢æ¿Ÿã€‘è’¸é‹è‡³å°Šï¼${person.name}å±¬${zodiac}ï¼Œç­†åŠƒ ${s} å®Œç¾ä¸­å’Œç«ç‡¥ã€‚ä»Šæ—¥å¾—çè±¡å¾µã€Œæ°´ç«å¹³è¡¡ã€ï¼Œä¿ä½‘å…¨å®¶é¦¬å¹´è’¸è’¸æ—¥ä¸Šï¼Œæ—¥å­è¶Šéè¶Šç´…ç«ã€‚`,
      `ã€æ—¢æ¿Ÿã€‘éˆé­‚ä¸»äººï¼${person.name}åå­—ä¸­çš„ã€Œ${nameWx}ã€æ­£æ˜¯ 2026 å¹´æœ€ç¼ºçš„æ°´æ°£ã€‚é€™å°è’¸é‹ä»£è¡¨æ°´ç«äº¤èï¼Œåªæœ‰ä½ æ‰èƒ½ç™¼æ®å®ƒã€Œæ—¢æ¿Ÿã€çš„é–‹é‹ç¥åŠ›ã€‚`,
      `ã€æ—¢æ¿Ÿã€‘æ°´ç«ç›¸èï¼${person.name}å±¬${zodiac}ä¸”ç”Ÿæ–¼å†¬æœˆã€‚é€™ä»½çé …è±¡å¾µå°‡é¦¬å¹´çš„æš´èºåŒ–ç‚ºæº«æ½¤ï¼Œç¥ä½ åœ¨ 2026 å¹´äº‹æ¥­å®¶åº­é›™è±æ”¶ï¼Œå¦‚è’¸æ±½èˆ¬é£›å‡ã€‚`,
      `ã€æ—¢æ¿Ÿã€‘è¬ç‰©ç”Ÿé•·ï¼${person.name}ç­†åŠƒ ${s} ç•«æ ¼å…¥ä¸­å®®ã€‚æŠ½åˆ°è’¸é‹ï¼Œè±¡å¾µä½ å…·å‚™èª¿å’Œå®¶åº­èˆ‡è²¡å¯Œçš„èƒ½åŠ›ï¼Œä»Šå¹´å¿…èƒ½ã€Œæ°£ç››è²¡æ—ºã€ã€‚`,
      `ã€æ—¢æ¿Ÿã€‘è’¸æ±½é¨°é¨°ï¼${person.name}å§“åä¸­å¸¶${nameWx}ï¼Œèˆ‡ç«é¦¬å¹´æ§‹æˆã€Œæ—¢æ¿Ÿå¦ã€ã€‚å¾—æ­¤è’¸é‹ï¼Œç¥ä½ é¦¬å¹´é‹å‹¢è’¸è’¸æ—¥ä¸Šï¼Œå¹¸ç¦æ»¿æº¢ã€‚`,
      `ã€æ—¢æ¿Ÿã€‘èª¿å’Œä¹‹ç‹ï¼${person.name}å±¬${zodiac}ï¼Œæ€§æ ¼æº«æ½¤ã€‚é€™ä»½ç¦®ç‰©æ˜¯ç¥æ˜å°ä½ ã€Œæ°´ç«å¹³è¡¡ã€ç‰¹è³ªçš„èªå¯ï¼Œä¿ä½‘ä½  2026 å¹´å®¶å®…å¹³å®‰ã€å–œäº‹é€£é€£ã€‚`,
      `ã€æ—¢æ¿Ÿã€‘è’¸è’¸æ—¥ä¸Šï¼${person.name}ç”Ÿæ–¼${tg}${dz}å¹´ã€‚åœ¨é›¢ç«é‹ä¸­ï¼Œä½ ä»¥ã€Œæ°´ã€ä¹‹æŸ”å…‹ã€Œç«ã€ä¹‹å‰›ï¼Œå¾—æ­¤çé …ï¼Œè±¡å¾µä»Šå¹´ç”Ÿæ´»å¹¸ç¦æ„Ÿæ»¿æ»¿ã€‚`
    ]
  };

  const currentTemplates = templates[roundId] || [`ã€é¦¬å¹´å¤§å‰ã€‘${person.name} ç¥æ‚¨ 2026 è¬äº‹å¦‚æ„ï¼`];
  return currentTemplates[hashIndex % currentTemplates.length];
}

// --------------------------------------------------------
// æŠ½çæ ¸å¿ƒé‚è¼¯
// --------------------------------------------------------

export function drawWinners(pool, count, roundId) {
  const scored = pool.map(p => {
    const n = calcNameScore(p.name);
    const b = calcBaziScore(p.birthday);
    
    // å§“åäº”è¡Œä½”æ¯” 50%ï¼Œç”Ÿæ—¥ä½”æ¯” 20%ï¼Œéš¨æ©Ÿå€¼ä½”æ¯” 30% (é¿å…è®Šæˆç´”ç”Ÿè‚–æŠ½ç)
    let weight = n.affinity * 0.5 + b.score * 0.2 + Math.random() * 30;

    // é‡å°è¼ªæ¬¡ç›®æ¨™å¾®èª¿æ¬Šé‡
    if (roundId === 4 && n.wuxing === 'water') weight += 20; // è’¸é‹çåå¥½åå­—å¸¶æ°´/å†¬ç”Ÿ
    if (roundId === 3 && n.wuxing === 'metal') weight += 20; // èµ¤é¦¬éŠœé‡‘åå¥½åå­—å¸¶é‡‘/åœŸ
    
    return { ...p, _score: weight };
  });

  return scored.sort((a, b) => b._score - a._score).slice(0, Math.min(count, scored.length));
}

// --------------------------------------------------------
// é…ç½®èˆ‡å·¥å…·
// --------------------------------------------------------

export const ROUND_CONFIGS = [
  { id: 1, name: 'ğŸ§§ é›¢ç«å¾®å…‰ãƒ»äº”è¡Œè£œé‹ç', shortName: 'ä¸€è¼ª', emoji: 'ğŸ”¥', defaultCount: 10, poolMode: 'current', themeColor: '#FF6B00' },
  { id: 2, name: 'ğŸ”± ç¥å…‰æ™®ç…§ãƒ»å¤©åå¥‘å­ç', shortName: 'äºŒè¼ª', emoji: 'ğŸ™', defaultCount: 12, poolMode: 'remaining', themeColor: '#FFD700' },
  { id: 3, name: 'ğŸ’° ä¸™åˆé‡‘åŒ±ãƒ»èµ¤é¦¬éŠœé‡‘ç', shortName: 'ä¸‰è¼ª', emoji: 'ğŸ†', defaultCount: 1, poolMode: 'all', themeColor: '#FF215D' },
  { id: 4, name: 'â™¨ï¸ ç‰¹åˆ¥çï¼šæ°´ç«æ—¢æ¿Ÿç', shortName: 'å››è¼ª', emoji: 'ğŸŒŸ', defaultCount: 1, poolMode: 'exclude_r3', themeColor: '#B8860B' },
];

export function getRandomDivination(roundId, person) {
  return person ? buildDivinationText(person, roundId) : "å¤©å®˜è³œç¦ï¼Œå¥½é‹é™è‡¨ï¼";
}

export function parseParticipants(rawText) {
  return rawText.split('\n').filter(Boolean).map(line => {
    const parts = line.split(',').map(p => p.trim());
    const name = parts[0];
    const birthday = parts[1] || '';
    return { id: `${name}-${Math.random()}`, name, birthday };
  });
}

export function shuffleArray(array) {
  const arr = [...array];
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}